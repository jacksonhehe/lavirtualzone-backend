<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Mi Liga Master - Gestiona tu club, jugadores y transacciones en La Virtual Zone">
  <meta name="keywords" content="Liga Master, La Virtual Zone, Videojuegos, Parsec, Torneos, Gaming">
  <meta name="theme-color" content="#0a0a1a">
  <meta name="robots" content="index, follow">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <title>Mi Liga Master | La Virtual Zone</title>

  <!-- Fuentes y Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" 
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- Estilos internos (puedes extraer a styles.css) -->
  <style>
    :root {
      --primary-cyan: #00ffff;
      --secondary-purple: #800080;
      --dark-bg: #0a0a1a;
      --light-bg: #2a2a3a;
      --text-primary: #ffffff;
      --text-secondary: #b0b0c0;
      --border-light: rgba(0, 255, 255, 0.2);
      --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.3);
      --shadow-cyan: 0 6px 18px rgba(0, 255, 255, 0.15);
      --transition-base: 0.3s ease-in-out;
      --accent-green: #66ff66;
    }
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Roboto', sans-serif;
      line-height: 1.7;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      position: relative;
      transition: opacity 0.5s ease;
    }
    body.fade-out {
      opacity: 0;
    }
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, rgba(10, 10, 26, 0.95), rgba(10, 10, 26, 1));
      z-index: -1;
      opacity: 0.9;
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    /* Header */
    .main-header {
      background: rgba(10, 10, 26, 0.98);
      backdrop-filter: blur(8px);
      padding: 1rem 2rem;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      border-bottom: 1px solid var(--border-light);
      box-shadow: var(--shadow-soft);
    }
    .nav-container {
      max-width: 1440px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 60px;
    }
    .logo {
      width: 60px;
      height: 60px;
      background: url('/images/logo-la-virtual-zone.svg') no-repeat center center, #00ffff;
      background-size: contain;
      text-indent: -9999px;
      transition: var(--transition-base);
      border: 1px solid var(--border-light);
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    .logo:hover {
      opacity: 0.9;
    }
    .main-nav {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }
    .nav-link {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 400;
      font-size: 1rem;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      transition: var(--transition-base);
      letter-spacing: 0.5px;
    }
    .nav-link:hover {
      color: var(--primary-cyan);
      background: rgba(0, 255, 255, 0.1);
      box-shadow: var(--shadow-cyan);
    }
    .mobile-menu, .close-menu {
      display: none;
      background: none;
      border: none;
      color: var(--primary-cyan);
      font-size: 1.8rem;
      padding: 0.5rem;
      cursor: pointer;
      transition: var(--transition-base);
    }
    .mobile-menu:hover, .close-menu:hover {
      color: var(--secondary-purple);
    }
    /* Hero del Dashboard */
    .dashboard-hero {
      padding: 160px 3rem 8rem;
      background: linear-gradient(to bottom, rgba(10, 10, 26, 0.9), rgba(10, 10, 26, 1));
      min-height: 70vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
    }
    .dashboard-hero::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40%;
      background: linear-gradient(to top, var(--dark-bg), transparent);
      z-index: 1;
    }
    .hero-title {
      font-family: 'Orbitron', sans-serif;
      font-size: clamp(2.5rem, 6vw, 4.5rem);
      margin-bottom: 2rem;
      color: var(--text-primary);
      line-height: 1.2;
      font-weight: 700;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
      position: relative;
      z-index: 2;
    }
    .hero-subtitle {
      color: var(--text-secondary);
      font-size: clamp(1.2rem, 2.5vw, 1.6rem);
      max-width: 800px;
      margin: 0 auto 3rem;
      font-weight: 300;
      position: relative;
      z-index: 2;
    }
    /* Navegación interna */
    .section-nav {
      position: sticky;
      top: 60px;
      background: var(--light-bg);
      padding: 0.5rem;
      border-bottom: 1px solid var(--border-light);
      box-shadow: var(--shadow-soft);
      z-index: 900;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .section-nav-link {
      color: var(--text-primary);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: var(--transition-base);
    }
    .section-nav-link:hover {
      color: var(--primary-cyan);
      background: rgba(0, 255, 255, 0.1);
      outline: 2px solid var(--primary-cyan);
      outline-offset: 2px;
    }
    /* Secciones generales */
    .section {
      padding: 7rem 3rem;
      background: var(--dark-bg);
    }
    .section-title {
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      font-size: clamp(2rem, 5vw, 3rem);
      margin-bottom: 4rem;
      color: var(--primary-cyan);
      font-weight: 700;
      letter-spacing: 1px;
      position: relative;
      text-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
    }
    .section-title::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      width: 120px;
      height: 3px;
      background: var(--primary-cyan);
      transform: translateX(-50%);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    /* Club y acciones */
    .club-container {
      max-width: 1280px;
      margin: 0 auto;
      background: linear-gradient(135deg, rgba(42, 42, 58, 0.9), rgba(10, 10, 26, 0.9));
      padding: 2.5rem;
      border-radius: 16px;
      border: 2px solid var(--primary-cyan);
      box-shadow: var(--shadow-cyan);
      position: relative;
      z-index: 1;
    }
    .club-header {
      display: flex;
      gap: 2rem;
      margin-bottom: 2rem;
      align-items: center;
    }
    .club-emblem {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background-color: var(--primary-cyan);
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 10 L90 40 L90 60 L50 90 L10 60 L10 40 Z" fill="white"/></svg>');
      background-size: 85%;
      background-position: center;
      background-repeat: no-repeat;
      transition: var(--transition-base);
      box-shadow: var(--shadow-soft);
      flex-shrink: 0;
    }
    .club-emblem:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: var(--shadow-cyan);
    }
    .club-info {
      flex: 1;
    }
    .club-name {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-cyan);
      font-size: 2rem;
      margin-bottom: 1.5rem;
      letter-spacing: 1px;
      text-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
    }
    .progress-bar {
      margin-top: 1rem;
      background: var(--dark-bg);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 0.6rem;
      transition: var(--transition-base);
    }
    .progress-fill {
      height: 12px;
      background: var(--primary-cyan);
      border-radius: 8px;
      transition: width 0.5s ease-in-out;
    }
    .progress-bar span {
      font-size: 1.1rem;
      color: var(--text-primary);
      margin-top: 0.5rem;
      display: block;
      font-weight: 500;
    }
    .player-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
      max-height: 400px;
      overflow-y: auto;
    }
    .player-card {
      background: var(--light-bg);
      border-radius: 12px;
      padding: 1.8rem;
      border: 2px solid transparent;
      transition: var(--transition-base);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .player-card:hover {
      border-color: var(--primary-cyan);
      transform: translateY(-8px);
      box-shadow: 0 12px 24px rgba(0, 255, 255, 0.3);
    }
    .player-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1.2rem;
      border: 2px solid var(--primary-cyan);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }
    .player-card h3 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-cyan);
      font-size: 1.4rem;
      margin-bottom: 1rem;
      letter-spacing: 0.5px;
      text-shadow: 0 0 6px rgba(0, 255, 255, 0.1);
    }
    .player-stats {
      list-style: none;
      margin-bottom: 1.2rem;
    }
    .player-stats li {
      font-size: 1.1rem;
      color: var(--text-primary);
      margin-bottom: 0.7rem;
      font-weight: 500;
    }
    .train-button {
      padding: 0.8rem 1.8rem;
      background: linear-gradient(45deg, var(--primary-cyan), rgba(0, 255, 255, 0.8));
      color: var(--text-primary);
      border: 2px solid var(--primary-cyan);
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition-base);
      box-shadow: 0 4px 12px rgba(0, 255, 255, 0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }
    .train-button:hover {
      background: linear-gradient(45deg, var(--secondary-purple), rgba(128, 0, 128, 0.8));
      border-color: var(--secondary-purple);
      box-shadow: 0 8px 20px rgba(128, 0, 128, 0.3);
      transform: translateY(-2px) rotate(2deg);
    }
    .train-button:disabled {
      background: var(--text-secondary);
      border-color: var(--text-secondary);
      cursor: not-allowed;
      opacity: 0.7;
      box-shadow: none;
      transform: none;
    }
    .club-actions {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      align-items: center;
    }
    .club-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
      max-width: 400px;
    }
    .form-label {
      color: var(--text-secondary);
      font-size: 1rem;
      margin-bottom: 0.3rem;
      font-weight: 500;
    }
    .form-input, .form-select {
      padding: 1rem;
      background: var(--dark-bg);
      border: 2px solid var(--border-light);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 1rem;
      transition: var(--transition-base);
      width: 100%;
      max-width: 400px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      z-index: 2;
    }
    .form-input:focus, .form-select:focus {
      border-color: var(--primary-cyan);
      box-shadow: 0 6px 16px rgba(0, 255, 255, 0.3);
      outline: none;
    }
    .action-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .enhanced-button {
      display: inline-flex;
      align-items: center;
      gap: 0.8rem;
      padding: 1rem 2.5rem;
      background: linear-gradient(45deg, var(--primary-cyan), rgba(0, 255, 255, 0.8));
      color: var(--text-primary);
      border: 2px solid var(--primary-cyan);
      border-radius: 12px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 1.2rem;
      transition: var(--transition-base);
      box-shadow: 0 4px 12px rgba(0, 255, 255, 0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      position: relative;
      z-index: 2;
    }
    .enhanced-button:hover {
      background: linear-gradient(45deg, var(--secondary-purple), rgba(128, 0, 128, 0.8));
      border-color: var(--secondary-purple);
      box-shadow: 0 8px 20px rgba(128, 0, 128, 0.3);
      transform: translateY(-2px) rotate(2deg);
    }
    .enhanced-button:disabled {
      background: var(--text-secondary);
      border-color: var(--text-secondary);
      cursor: not-allowed;
      opacity: 0.7;
      box-shadow: none;
      transform: none;
    }
    .container {
      max-width: 1280px;
      margin: 0 auto;
    }
    .watchlist, .transactions-list, .leaderboard-list {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      padding: 1rem;
      border-radius: 8px;
      max-height: 280px;
      overflow-y: auto;
      background: var(--light-bg);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-soft);
    }
    .watchlist li, .transactions-list li, .leaderboard-list li {
      padding: 0.5rem 1rem;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      gap: 1rem;
      max-height: 60px;
      overflow-y: hidden;
    }
    .watchlist img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      margin-left: 1rem;
    }
    .stats-grid, .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2.5rem;
      max-width: 1280px;
      margin: 0 auto;
    }
    .stat-item, .achievement-card {
      background: var(--light-bg);
      border-radius: 12px;
      padding: 2rem;
      border: 1px solid var(--border-light);
      transition: var(--transition-base);
      box-shadow: var(--shadow-soft);
      text-align: center;
    }
    .stat-item:hover, .achievement-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-cyan);
      border-color: var(--primary-cyan);
    }
    .stat-number {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      color: var(--primary-cyan);
      margin-bottom: 1rem;
    }
    .achievement-card.completed {
      border-color: var(--accent-green);
    }
    .achievement-card i {
      font-size: 2rem;
      color: var(--accent-green);
      margin-bottom: 1rem;
    }
    .achievement-card h3 {
      font-family: 'Orbitron', sans-serif;
      color: var(--primary-cyan);
      font-size: 1.4rem;
      margin-bottom: 1rem;
    }
    .back-to-top {
      position: fixed;
      bottom: 2.5rem;
      right: 2.5rem;
      background: var(--primary-cyan);
      color: var(--text-primary);
      padding: 1.2rem;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      opacity: 0;
      transition: var(--transition-base);
      box-shadow: var(--shadow-cyan);
      transform: translateY(20px);
      z-index: 1000;
    }
    .back-to-top.show {
      opacity: 1;
      transform: translateY(0);
    }
    .back-to-top:hover {
      background: var(--secondary-purple);
      box-shadow: 0 6px 20px rgba(128, 0, 128, 0.25);
    }
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.3rem;
      color: var(--primary-cyan);
      display: none;
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.3s ease;
      background: var(--light-bg);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-cyan);
    }
    .loading.active {
      display: block;
      opacity: 1;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--light-bg);
      padding: 1rem 2rem;
      border-radius: 8px;
      border: 1px solid var(--primary-cyan);
      box-shadow: var(--shadow-cyan);
      z-index: 2000;
      animation: slideIn 0.5s ease-out forwards;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(0, 255, 255, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.6s ease-out forwards;
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    @media (max-width: 768px) {
      .main-nav {
        display: none;
        position: fixed;
        top: 60px;
        left: 0;
        width: 100%;
        height: 100vh;
        background: var(--dark-bg);
        flex-direction: column;
        padding: 2rem;
        z-index: 999;
      }
      .main-nav.show {
        display: flex;
      }
      .mobile-menu, .close-menu {
        display: block;
      }
      .close-menu {
        position: absolute;
        top: 1rem;
        right: 1rem;
      }
      .dashboard-hero {
        padding: 100px 2rem 4rem;
      }
      .hero-title {
        font-size: 2rem;
      }
      .hero-subtitle {
        font-size: 1rem;
      }
      .section-nav {
        display: none;
      }
      .section {
        padding: 3rem 2rem;
      }
      .club-header {
        flex-direction: column;
        text-align: center;
      }
      .club-emblem {
        width: 100px;
        height: 100px;
      }
      .player-grid {
        grid-template-columns: 1fr;
      }
      .stats-grid, .achievements-grid, .watchlist, .transactions-list, .leaderboard-list {
        grid-template-columns: 1fr;
      }
      .watchlist, .transactions-list, .leaderboard-list {
        max-height: 200px;
      }
    }
  </style>
</head>
<body>
  <header class="main-header" role="banner">
    <nav class="nav-container" aria-label="Navegación principal">
      <a href="index.html" class="logo" aria-label="Inicio de La Virtual Zone"></a>
      <button class="mobile-menu" aria-label="Abrir menú" aria-expanded="false" aria-controls="main-nav">
        <i class="fas fa-bars" aria-hidden="true"></i>
      </button>
      <div class="main-nav" id="main-nav" role="navigation" aria-label="Secciones principales">
        <button class="close-menu" aria-label="Cerrar menú"><i class="fas fa-times" aria-hidden="true"></i></button>
        <a href="index.html" class="nav-link transition-link" data-href="index.html">Inicio</a>
        <a href="liga-master.html" class="nav-link transition-link" data-href="liga-master.html">Liga Master</a>
        <a href="mi-liga-master.html" class="nav-link">Mi Club</a>
        <a href="mercado-fichajes.html" class="nav-link transition-link" data-href="mercado-fichajes.html">Mercado de Fichajes</a>
        <a href="login.html" id="logoutLink" class="nav-link transition-link" data-href="login.html">Cerrar Sesión</a>
      </div>
    </nav>
  </header>

  <main role="main">
    <!-- Hero -->
    <section class="dashboard-hero" aria-labelledby="dashboard-heading">
      <h1 class="hero-title" id="dashboard-heading">Mi Liga Master</h1>
      <p class="hero-subtitle">Gestiona tu club, sigue jugadores y compite por los mejores logros en La Virtual Zone.</p>
    </section>

    <!-- Navegación interna -->
    <nav class="section-nav" aria-label="Navegación interna">
      <a href="#club-section" class="section-nav-link">Tu Club</a>
      <a href="#watchlist-section" class="section-nav-link">Jugadores Seguidos</a>
      <a href="#transactions-section" class="section-nav-link">Transacciones</a>
      <a href="#stats-section" class="section-nav-link">Estadísticas</a>
      <a href="#achievements-section" class="section-nav-link">Logros</a>
      <a href="#leaderboard-section" class="section-nav-link">Clasificación</a>
    </nav>

    <!-- Sección: Tu Club -->
    <section class="section" id="club-section" aria-labelledby="club-heading">
      <h2 class="section-title" id="club-heading">Tu Club <i class="fas fa-info-circle info-icon" aria-label="Información sobre tu club" tabindex="0">
        <span class="tooltip">Gestiona tu club, entrena jugadores y utiliza el mercado para mejorar tu equipo.</span>
      </i></h2>
      <div class="club-container animate-fade-in">
        <div class="club-header">
          <div class="club-emblem" id="clubEmblem" role="img" aria-label="Emblema del club"></div>
          <div class="club-info">
            <h3 class="club-name" id="clubName">[Sin registrar]</h3>
            <div class="progress-bar" role="progressbar" aria-label="Presupuesto del club">
              <div class="progress-fill" id="budgetProgress" style="width: 100%;"></div>
              <span>Presupuesto: $<span id="clubBudget">100,000,000</span></span>
            </div>
            <p>Jugadores: <span id="playerCount">0</span></p>
            <div class="progress-bar" role="progressbar" aria-label="Valor total del club">
              <div class="progress-fill" id="valueProgress" style="width: 0%;"></div>
              <span>Valor Total: $<span id="teamValue">0</span></span>
            </div>
            <div class="progress-bar" role="progressbar" aria-label="Rating promedio del club">
              <div class="progress-fill" id="ratingProgress" style="width: 0%;"></div>
              <span>Rating Promedio: <span id="avgRating">0</span></span>
            </div>
          </div>
        </div>
        <div class="player-grid" id="playerList" role="list" aria-label="Lista de jugadores del club"></div>
        <div class="club-actions">
          <form class="club-form" id="clubForm" aria-label="Formulario de tu club">
            <label for="clubNameInput" class="form-label">Nombre del Club</label>
            <input type="text" id="clubNameInput" class="form-input" placeholder="Nombre del Club" aria-label="Nombre del club">
            <label for="clubColor" class="form-label">Color del Club</label>
            <select id="clubColor" class="form-select" aria-label="Color del club">
              <option value="#00ffff">Cian</option>
              <option value="#800080">Púrpura</option>
              <option value="#66ff66">Verde</option>
            </select>
            <button type="submit" class="cta-button enhanced-button">Guardar</button>
          </form>
          <div class="action-buttons">
            <button id="resetClub" class="reset-button enhanced-button" aria-label="Reiniciar club">Reiniciar Club</button>
            <button id="simulateMatch" class="cta-button enhanced-button" aria-label="Simular un partido">Simular Partido</button>
            <a href="mercado-fichajes.html" class="cta-button enhanced-button transition-link" data-href="mercado-fichajes.html" aria-label="Ir al Mercado de Fichajes">Ir al Mercado</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Sección: Jugadores Seguidos -->
    <section class="section" id="watchlist-section" aria-labelledby="watchlist-heading">
      <h2 class="section-title" id="watchlist-heading">Jugadores Seguidos</h2>
      <div class="container animate-fade-in">
        <ul id="watchlist" class="watchlist" role="list" aria-label="Lista de jugadores seguidos"></ul>
      </div>
    </section>

    <!-- Sección: Historial de Transacciones -->
    <section class="section" id="transactions-section" aria-labelledby="transactions-heading">
      <h2 class="section-title" id="transactions-heading">Historial de Transacciones</h2>
      <div class="container animate-fade-in">
        <ul id="transactionList" class="transactions-list" role="list" aria-label="Historial de transacciones"></ul>
        <button id="exportTransactions" class="cta-button enhanced-button" aria-label="Exportar transacciones">Exportar Transacciones</button>
      </div>
    </section>

    <!-- Sección: Estadísticas del Club -->
    <section class="section" id="stats-section" aria-labelledby="stats-heading">
      <h2 class="section-title" id="stats-heading">Estadísticas del Club</h2>
      <div class="container animate-fade-in">
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="winsCount">0</div>
            <p>Victorias</p>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="gamesPlayed">0</div>
            <p>Partidos Jugados</p>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="seasonProgress">0/5</div>
            <p>Progreso Temporada</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Sección: Logros -->
    <section class="section" id="achievements-section" aria-labelledby="achievements-heading">
      <h2 class="section-title" id="achievements-heading">Logros</h2>
      <div class="container animate-fade-in">
        <div class="achievements-grid">
          <div class="achievement-card" id="first-buy"></div>
          <div class="achievement-card" id="top-10"></div>
          <div class="achievement-card" id="million-spent"></div>
          <div class="achievement-card" id="best-team"></div>
        </div>
      </div>
    </section>

    <!-- Sección: Clasificación -->
    <section class="section" id="leaderboard-section" aria-labelledby="leaderboard-heading">
      <h2 class="section-title" id="leaderboard-heading">Clasificación Liga Master</h2>
      <div class="container animate-fade-in">
        <ul id="leaderboardList" class="leaderboard-list" role="list" aria-label="Clasificación de la liga"></ul>
      </div>
    </section>
  </main>

  <div class="loading" id="loadingSpinner"><i class="fas fa-spinner fa-spin"></i> Cargando...</div>

  <button class="back-to-top" aria-label="Volver al inicio">
    <i class="fas fa-arrow-up" aria-hidden="true"></i>
  </button>

  <footer class="main-footer" role="contentinfo">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Contacto</h3>
        <p><a href="mailto:lavirtualzone@gmail.com">lavirtualzone@gmail.com</a></p>
        <p><a href="tel:+34123456789">+34 123 456 789</a></p>
      </div>
      <div class="footer-section">
        <h3>Redes Sociales</h3>
        <a href="https://twitch.tv/lavirtualzone" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Canal de Twitch">
          <i class="fab fa-twitch" aria-hidden="true"></i> Twitch
        </a>
        <a href="https://discord.com/invite/lavirtualzone" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Servidor de Discord">
          <i class="fab fa-discord" aria-hidden="true"></i> Discord
        </a>
      </div>
      <div class="footer-section">
        <h3>Enlaces Útiles</h3>
        <a href="/reglamento" class="social-link">Reglamento Oficial</a>
        <a href="/privacidad" class="social-link">Política de Privacidad</a>
      </div>
    </div>
  </footer>

  <script>
    const BASE_URL = window.location.origin;
    
    let club = {
      name: localStorage.getItem('clubName') || '[Sin registrar]',
      budget: parseInt(localStorage.getItem('clubBudget')) || 100000000,
      players: JSON.parse(localStorage.getItem('clubPlayers') || '[]') || [],
      points: parseInt(localStorage.getItem('marketPoints')) || 0,
      watchlist: JSON.parse(localStorage.getItem('watchlist') || '[]') || []
    };
    const season = {
      start: new Date().getTime() - 24 * 60 * 60 * 1000,
      end: new Date().getTime() + 30 * 24 * 60 * 60 * 1000
    };
    let isMarketOpen = false;
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let loanedPlayers = JSON.parse(localStorage.getItem('loanedPlayers')) || [];
    let isProcessing = false;
    let playersMarket = [];

    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Debes iniciar sesión para acceder a esta página.', 'error');
        setTimeout(() => window.location.href = 'login.html', 2000);
        return;
      }
      if (!(await validateToken())) return;
      
      // Menú móvil
      const menuButton = document.querySelector('.mobile-menu');
      const closeButton = document.querySelector('.close-menu');
      const mainNav = document.querySelector('.main-nav');
      function toggleMenu() {
        mainNav.classList.toggle('show');
        const isExpanded = mainNav.classList.contains('show');
        menuButton.setAttribute('aria-expanded', isExpanded);
      }
      menuButton.addEventListener('click', toggleMenu);
      closeButton.addEventListener('click', toggleMenu);

      // Sincronizar datos y renderizar contenido
      const spinner = document.getElementById('loadingSpinner');
      spinner.classList.add('active');
      try {
        await initializePage();
      } catch (err) {
        showNotification('Error al cargar datos: ' + err.message, 'error');
      } finally {
        spinner.classList.remove('active');
        isProcessing = false;
      }
    });

    async function validateToken() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`${BASE_URL}/api/auth/me`, {
          method: 'GET',
          headers: { 'x-auth-token': token }
        });
        if (response.ok) {
          return true;
        } else {
          localStorage.removeItem('token');
          showNotification('Sesión expirada. Por favor, inicia sesión nuevamente.', 'error');
          setTimeout(() => window.location.href = 'login.html', 2000);
          return false;
        }
      } catch (err) {
        localStorage.removeItem('token');
        showNotification('Error de conexión. Por favor, inicia sesión nuevamente.', 'error');
        window.location.href = 'login.html';
        return false;
      }
    }

    async function initializePage() {
      await syncClubData();
      await syncTransactions();
      await loadMarketData();
      updateClubPreview();
      updateWatchlist();
      updateTransactions();
      updateStats();
      bindMarketEvents();
    }

    async function syncClubData() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`${BASE_URL}/api/club/me`, {
          method: 'GET',
          headers: { 'x-auth-token': token }
        });
        if (!response.ok) {
          const errorData = await response.json();
          if (response.status === 401) {
            localStorage.removeItem('token');
            showNotification('Sesión expirada. Inicia sesión nuevamente.', 'error');
            setTimeout(() => window.location.href = 'login.html', 2000);
            return;
          }
          throw new Error(errorData.message || 'Error al sincronizar datos del club');
        }
        club = await response.json();
        season.wins = club.wins || 0;
        localStorage.setItem('clubName', club.name);
        localStorage.setItem('clubBudget', club.budget);
        localStorage.setItem('clubPlayers', JSON.stringify(club.players));
        localStorage.setItem('clubColor', club.color);
        localStorage.setItem('clubWins', club.wins);
      } catch (err) {
        console.error('Error en syncClubData:', err);
        throw err;
      }
    }

    async function syncTransactions() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`${BASE_URL}/api/transactions`, {
          method: 'GET',
          headers: { 'x-auth-token': token }
        });
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Error al sincronizar transacciones');
        }
        transactions = await response.json();
        updateTransactions();
      } catch (err) {
        console.error('Error en syncTransactions:', err);
        transactions = [];
        updateTransactions();
      }
    }

    async function loadMarketData() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`${BASE_URL}/api/players`, {
          headers: { 'x-auth-token': token }
        });
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Error al cargar jugadores del mercado');
        }
        playersMarket = await response.json();
        updateMarketStatus();
      } catch (err) {
        console.error('Error en loadMarketData:', err);
        throw err;
      }
    }

    function updateTimer() {
      const now = new Date().getTime();
      const timerElem = document.getElementById('market-timer');
      if (!timerElem) return;
      const distance = season.end - now;
      if (distance < 0) {
        isMarketOpen = false;
        timerElem.textContent = "CERRADO";
        return;
      }
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((distance / 1000 / 60) % 60);
      const seconds = Math.floor((distance / 1000) % 60);
      timerElem.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
      isMarketOpen = now >= season.start && now <= season.end;
    }

    function updateMarketStatus() {
      // Aquí podrías actualizar algún indicador visual si lo deseas.
    }

    function updateClubPreview() {
      const clubNameInput = document.getElementById('clubNameInput');
      const clubColor = document.getElementById('clubColor');
      if (clubNameInput && clubColor) {
        clubNameInput.value = club.name;
        clubColor.value = club.color;
      }
      const clubNameElem = document.getElementById('clubName');
      const clubBudgetElem = document.getElementById('clubBudget');
      const playerCountElem = document.getElementById('playerCount');
      const teamValueElem = document.getElementById('teamValue');
      const avgRatingElem = document.getElementById('avgRating');
      const clubEmblem = document.getElementById('clubEmblem');
      const playerList = document.getElementById('playerList');
      if (!clubNameElem || !clubBudgetElem || !playerCountElem || !teamValueElem || !avgRatingElem || !clubEmblem || !playerList) {
        console.error('Elementos del DOM no encontrados en updateClubPreview');
        return;
      }
      clubNameElem.textContent = club.name;
      clubBudgetElem.textContent = `$${(club.budget || 0).toLocaleString()}`;
      playerCountElem.textContent = club.players.length;
      const totalValue = club.players.reduce((sum, p) => sum + (p.value || 0), 0);
      teamValueElem.textContent = `$${totalValue.toLocaleString()}`;
      const avg = club.players.length ? Math.floor(club.players.reduce((sum, p) => sum + (p.rating || 0), 0) / club.players.length) : 0;
      avgRatingElem.textContent = avg;
      playerList.innerHTML = club.players.length ? club.players.map(p => `
        <li>${p.name} (${p.position}) - Rating: ${p.rating}, Valor: $${p.value.toLocaleString()}
          <button onclick="trainPlayer('${p._id}', '${p.name}', ${p.value})">Entrenar (+$${Math.floor((p.value || 0) * 0.1).toLocaleString()})</button>
        </li>
      `).join('') : '<li>No hay jugadores.</li>';
    }

    function updateWatchlist() {
      const watchlist = document.getElementById('watchlist');
      if (!watchlist) return;
      watchlist.innerHTML = club.watchlist.length ? club.watchlist.map(p => `
        <li>${p.name} - $${p.value.toLocaleString()}
          <button onclick="removeFromWatchlist('${p.name}')">Quitar</button>
        </li>
      `).join('') : '<li>No hay jugadores en la lista de seguimiento.</li>';
    }

    function updateTransactions() {
      const list = document.getElementById('transactionList');
      if (!list) return;
      list.innerHTML = transactions.length ? transactions.map(t => `
        <li>${new Date(t.date).toLocaleDateString()} – ${t.typeName || t.type} – ${t.playerName} – $${t.value.toLocaleString()}</li>
      `).join('') : '<li>No hay transacciones registradas.</li>';
    }

    function updateStats() {
      const winsCount = document.getElementById('winsCount');
      const gamesPlayed = document.getElementById('gamesPlayed');
      const seasonProgress = document.getElementById('seasonProgress');
      if (!winsCount || !gamesPlayed || !seasonProgress) return;
      winsCount.textContent = club.wins;
      gamesPlayed.textContent = club.gamesPlayed || 0;
      seasonProgress.textContent = `${club.wins || 0}/5`;
    }

    // Funciones de acciones sobre jugadores del club
    async function trainPlayer(id, name, value) {
      if (isProcessing || !isMarketOpen) {
        if (!isMarketOpen) showNotification('El mercado está cerrado.', 'error');
        return;
      }
      isProcessing = true;
      const cost = Math.floor(value * 0.1);
      if (club.budget < cost) {
        showNotification('No tienes suficiente presupuesto para entrenar a este jugador.', 'error');
        isProcessing = false;
        return;
      }
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Debes iniciar sesión.', 'error');
        window.location.href = 'login.html';
        return;
      }
      const playerIndex = club.players.findIndex(p => p._id === id);
      if (playerIndex === -1) {
        showNotification('Jugador no encontrado.', 'error');
        isProcessing = false;
        return;
      }
      // Actualiza localmente
      club.budget -= cost;
      club.players[playerIndex].rating = Math.min((club.players[playerIndex].rating || 0) + 1, 99);
      club.players[playerIndex].value = (value || 0) + cost;
      try {
        const response = await fetch(`${BASE_URL}/api/club/me/train`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'x-auth-token': token },
          body: JSON.stringify({ playerId: id, cost })
        });
        if (!response.ok) {
          const errorData = await response.json();
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
          }
          throw new Error(errorData.message || 'Error al entrenar');
        }
        const data = await response.json();
        club = data.club;
        localStorage.setItem('clubBudget', club.budget);
        localStorage.setItem('clubPlayers', JSON.stringify(club.players));
        showNotification(`¡${name} ha sido entrenado! Rating: ${club.players[playerIndex].rating} (+$${cost.toLocaleString()})`, 'success');
        updateClubPreview();
        updateAchievements();
      } catch (err) {
        showNotification('Error: ' + err.message, 'error');
        // Revertir cambios si es necesario
        club.budget += cost;
        club.players[playerIndex].rating = (club.players[playerIndex].rating || 0) - 1;
        club.players[playerIndex].value = value;
        localStorage.setItem('clubBudget', club.budget);
        localStorage.setItem('clubPlayers', JSON.stringify(club.players));
      } finally {
        isProcessing = false;
      }
    }

    function updateAchievements() {
      const firstBuy = document.getElementById('first-buy');
      const top10 = document.getElementById('top-10');
      const millionSpent = document.getElementById('million-spent');
      const bestTeam = document.getElementById('best-team');
      if (!firstBuy || !top10 || !millionSpent || !bestTeam) {
        console.error('Elementos de logros no encontrados');
        return;
      }
      firstBuy.innerHTML = `<i class="fas fa-shopping-bag" ${club.players.length > 0 ? '' : 'style="color: gray;"'}></i><h3>Primera Compra</h3><p>${club.players.length > 0 ? 'Completado' : 'Compra tu primer jugador'}</p>`;
      if (club.players.length > 0) firstBuy.classList.add('completed');
      top10.innerHTML = `<i class="fas fa-star"></i><h3>Top 10 Mundial</h3><p>${club.wins >= 10 ? 'Completado' : 'Alcanza 10 victorias'}</p>`;
      if (club.wins >= 10) top10.classList.add('completed');
      millionSpent.innerHTML = `<i class="fas fa-coins"></i><h3>Millonario</h3><p>${club.points >= 100 ? 'Completado' : 'Obtén 100 puntos'}</p>`;
      if (club.points >= 100) millionSpent.classList.add('completed');
      bestTeam.innerHTML = `<i class="fas fa-trophy"></i><h3>Mejor Equipo</h3><p>${club.players.length >= 11 ? 'Completado' : 'Forma un equipo de 11 jugadores'}</p>`;
      if (club.players.length >= 11) bestTeam.classList.add('completed');
    }

    // Funciones para acciones sobre la sesión y navegación interna
    document.getElementById('resetClub').addEventListener('click', async () => {
      if (!confirm('¿Estás seguro de reiniciar tu club? Esto eliminará todos tus datos.')) return;
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Debes iniciar sesión.', 'error');
        window.location.href = 'login.html';
        return;
      }
      try {
        const response = await fetch(`${BASE_URL}/api/club/me/reset`, {
          method: 'POST',
          headers: { 'x-auth-token': token }
        });
        if (!response.ok) {
          const errorData = await response.json();
          showNotification(errorData.message || 'Error al reiniciar el club', 'error');
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
          }
          return;
        }
        const data = await response.json();
        club = data.club;
        localStorage.setItem('clubName', club.name);
        localStorage.setItem('clubBudget', club.budget);
        localStorage.setItem('clubPlayers', JSON.stringify(club.players));
        localStorage.setItem('clubColor', club.color);
        localStorage.setItem('clubWins', club.wins);
        localStorage.setItem('transactions', JSON.stringify([]));
        localStorage.setItem('loanedPlayers', JSON.stringify([]));
        localStorage.setItem('watchlist', JSON.stringify([]));
        showNotification('¡Club reiniciado exitosamente!', 'success');
        location.reload();
      } catch (err) {
        showNotification('Error de conexión: ' + err.message, 'error');
      }
    });

    document.getElementById('simulateMatch').addEventListener('click', async () => {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`${BASE_URL}/api/club/me/simulate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'x-auth-token': token },
          body: JSON.stringify({ win: true })
        });
        if (!response.ok) {
          const errorData = await response.json();
          showNotification(errorData.message || 'Error al simular partido', 'error');
          return;
        }
        const data = await response.json();
        club = data.club;
        localStorage.setItem('clubBudget', club.budget);
        localStorage.setItem('clubPlayers', JSON.stringify(club.players));
        showNotification('¡Partido simulado! Club actualizado.', 'success');
        updateClubPreview();
        updateStats();
      } catch (err) {
        showNotification('Error de conexión: ' + err.message, 'error');
      }
    });

    // Función para mostrar notificaciones emergentes
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.setAttribute('aria-live', 'polite');
      notification.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${message}`;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.classList.add('show');
        setTimeout(() => {
          notification.classList.remove('show');
          notification.addEventListener('transitionend', () => notification.remove());
        }, 4000);
      }, 100);
    }

    function bindMarketEvents() {
      // Aquí puedes agregar eventos para filtrar, buscar, etc.
    }

    // Transiciones de enlaces con la clase "transition-link"
    document.querySelectorAll('.transition-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        document.body.classList.add('fade-out');
        setTimeout(() => window.location.href = link.getAttribute('data-href'), 500);
      });
    });
  </script>
</body>
</html>
